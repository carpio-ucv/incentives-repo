---
title: "Incentives_Analytical_Strategy"
author: "Juan Carpio"
date: "15 January 2016"
output: html_document
---

```{r,echo=TRUE, eval=TRUE, include=FALSE}
# Reading Clean File and setting relevant libraries.

## Change working directory
setwd("C:/Users/K56CA/Dropbox/PhD/Experiments Incentives/Follow_Up_Incentives")

##Relevant libraries
library("dplyr")
library("tidyr")
library("ggplot2")
library("reshape2")
library("Hmisc")

## read raw_data
data_clean_imp<-read.csv("clean_data.csv")
## correcting ID veriable
data_clean<- mutate(data_clean_imp, ID= X+1) %>% 
        select(ID, everything(), -X)

##Define factor variables

data_clean$r_amount <- factor(data_clean$r_amount, levels = c(1,2),
                      labels = c("£5", "£2")) 

data_clean$r_type <- factor(data_clean$r_type, levels = c(1,2),
                    labels = c("Cash", "Product")) 

data_clean$gender <- factor(data_clean$gender, levels = c(1,2),
                    labels = c("Male", "Female"))

data_clean$income <- factor(data_clean$income, levels = c(1:5),
                    labels = c("< 15k", "15k-19k",
                               "20k-29k", "> 30k", "No.Ans")) 

data_clean$employ <- factor(data_clean$employ, levels = c(1:6),
                    labels = c("FT-Emp", "PT-Emp","Unempl.", 
                               "Stud.", "Retired","Other")) 

## Addint totals for Measures: Neg.Evaluations and Expectations 

expect_1<-c("exp_x1_K","exp_x1_T", "exp_x1_S.R","exp_x1_G")
expect_2<-c("exp_x2_K","exp_x2_T", "exp_x2_S.R","exp_x2_G")
neg_eval<-c("neg.ev_1","neg.ev_2.R","neg.ev_3","neg.ev_4.R",
            "neg.ev_5","neg.ev_6","neg.ev_7.R","neg.ev_8",
            "neg.ev_9","neg.ev_10.R", "neg.ev_11","neg.ev_12")

final_df<-data_clean %>% mutate(
        tot_exp1 = rowMeans(.[expect_1]),
        tot_exp2 = rowMeans(.[expect_2]),
        tot_neg_eval = rowMeans(.[neg_eval])
        )  

# Code to audit cases ###################
# final_df %>% filter(ID==90) %>% gather()
#########################################

```

### Choices summary (Dependent variabl)
```{r}
tot_choices<-cbind(count(final_df, c(vd_0f)), count(final_df, c(vd_1f)),count(final_df, c(vd_2f)))
```


### FUNCTION calculating t.tests comparing AMOUNT size
```{r , echo=FALSE, eval=TRUE, include=TRUE}

t<-lapply(final_df[,c(2:12,31:33)], 
          function(x) t.test(x ~ final_df[,29], var.equal = TRUE))

ps<-data.frame(p.value = sapply(t, getElement, name = "p.value"))
format(ps, scientific = FALSE) 

```

### FUNCTION calculating Mann-Whitney (Non-Parametric) comparing AMOUNT size
```{r , echo=FALSE, eval=TRUE, include=TRUE}

t<-lapply(final_df[,c(2:12,31:33)], 
          function(x) wilcox.test(x ~ final_df[,29], var.equal = TRUE))

ps<-data.frame(p.value = sapply(t, getElement, name = "p.value"))
format(ps, scientific = FALSE) 

```


### FUNCTION calculating t.tests between REWARD TYPE(prod./cash)
```{r, echo=FALSE, eval=TRUE, include=TRUE}
t<-lapply(final_df[,c(2:12,31:33)], 
          function(x) t.test(x ~ final_df[,30], var.equal = TRUE))

ps<-data.frame(p.value = sapply(t, getElement, name = "p.value"))
format(ps, scientific = FALSE) 
```

### FUNCTION calculating Mann-Whitney (Non-Parametric) comparing REWARD TYPE(prod./cash)
```{r, echo=FALSE, eval=TRUE, include=TRUE}
t<-lapply(final_df[,c(2:12,31:33)], 
          function(x) wilcox.test(x ~ final_df[,30], var.equal = TRUE))

ps<-data.frame(p.value = sapply(t, getElement, name = "p.value"))
format(ps, scientific = FALSE) 
```

## Scheme rankings and TYPE of reward.
Higher numbers represent expectations of negatives reactions whereas lower numbers imply positive expectations.  
```{r, echo=FALSE, eval=TRUE, include=TRUE}
g2data<-melt(final_df, measure.var= c("vd_0f","vd_2f","vd_1f"), 
         id.var = c("r_type", "r_amount"))

ggplot(g2data, aes(x=value, fill=r_type)) +
        geom_bar(stat_count="identity",position="dodge",binwidth=0.5)+
        facet_grid(~variable)+
        #geom_errorbar(limits, position=dodge, width=0.25)+
        scale_x_discrete(breaks=c(1,2,3))+
        #coord_cartesian(ylim=c(0, 4.5))+
        theme_bw()

#dev.copy(jpeg,"figures/prueba2.jpeg")
#dev.off()


## Expectations about friends reactions.
Higher numbers represent expectations of negatives reactions whereas lower numbers imply positive expectations.  
```{r, echo=FALSE, eval=TRUE, include=TRUE}
gdata<-melt(final_df, measure.var= c("tot_exp1", "tot_exp2" ), 
         id.var = c("r_type", "r_amount"))

ggplot(gdata, aes(x=r_type, y=value, fill=variable))+
        geom_bar(stat="summary", fun.y="mean", position="dodge")+ 
        #geom_errorbar(limits, position=dodge, width=0.25)+
        scale_y_continuous(limits =c(0,9), breaks=seq(0,9, 0.5))+
        coord_cartesian(ylim=c(0, 4.5))+
        theme_bw()

#dev.copy(jpeg,"figures/prueba2.jpeg")
#dev.off()
```

## Fears of negatives evaluations, and typy of reward (amount/type).

```{r, echo=FALSE, eval=TRUE, include=TRUE}

ggplot(final_df, aes(x=r_type, y=tot_neg_eval, fill=r_amount)) +
        geom_bar(stat="summary",fun.y="mean",position="dodge")+
        scale_y_continuous(limits =c(0,5), breaks=seq(0,9, 0.5))+
        coord_cartesian(ylim=c(0, 4.5))+
        theme_bw()

#dev.copy(jpeg,"figures/prueba2.jpeg")
#dev.off()
```


```{r, echo=FALSE, eval=TRUE, include=TRUE}
yy<- select(final_df, tot_exp1,tot_exp2,tot_neg_eval, 
        vd_0f, vd_2f, vd_1f)
cor(yy)                             

#dev.copy(jpeg,"figures/prueba2.jpeg")
#dev.off()
```